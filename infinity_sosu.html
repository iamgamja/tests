<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> infinity_sosu </title>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script>
      $(function() {
        
        if (typeof(Worker) !== "undefined") {
          
          w = new Worker('sosu_calculator.js');
          
          let timer = undefined;
          
          w.onmessage = function(event) {
            // console.log(event.data);
            if (event.data.toString().endsWith('~')) {
              console.log('event.data가 ~로 끝났기 때문에 타이머가 실행됨. ', 'event.data는', event.data);
              timer = setInterval(function() {
                $('span#output').text($('span#output').text() + event.data.slice(0, -1));
                console.log('타이머에서 실행됨')
              }, 100);
            } else {
              $('span#output').text($('span#output').text() + event.data);
              console.log('타이머 밖에서 실행됨')
            }
          }
          
          $('*').bind('keyup', function(event) {
            if (event.keyCode == 13 && timer !== undefined) {
              clearInterval(timer);
              timer = undefined;
              $('span#output').text('');
              w.postMessage( [$('#number1').val(), $('#number2').val()] );
            }
          });
          
        } else {
          console.log('worker 를! 지원하지 않는');
        }
        
      });
    </script>
  </head>
  
  <body>
    <input type="number" id="number1" class="inputs" value="1"> /
    <input type="number" id="number2" class="inputs" value="3"> =<br>
    <span id="output"></span>
  </body>
</html>
